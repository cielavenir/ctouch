//cTouch bootstrap core: var useragent/enable_imitation/generate_touch is defined.
if(generate_touch){
///__BOUNDARY__///
//generated by ctouch_inner.rb
inject_tag('ctouch_touch_js','KGZ1bmN0aW9uKCl7CnZhciByZWMxPWZ1bmN0aW9uKG8sbixkLGUseil7CnZhciBzZW50PWZhbHNlOwppZihuPT1vfHwhbilyZXR1cm4gZmFsc2U7CmlmKG5bel0pe25bel0oZSk7c2VudD10cnVlO30KaWYocmVjMShuLG4ucGFyZW50Tm9kZSxkLGUseikpe3NlbnQ9dHJ1ZTt9CnJldHVybiBzZW50Owp9Owp2YXIgcmVjMj1mdW5jdGlvbihvLHgseSxkLGUseil7CnZhciBzZW50PWZhbHNlOwp2YXIgbiA9IGQuZWxlbWVudEZyb21Qb2ludCh4LHkpOwppZihuPT1vfHwhbilyZXR1cm4gZmFsc2U7CmlmKG5bel0pe25bel0oZSk7c2VudD10cnVlO30KdmFyIHYgPSBuLnN0eWxlLnZpc2liaWxpdHk7Cm4uc3R5bGUudmlzaWJpbGl0eSA9ICdoaWRkZW4nOwppZihyZWMyKG4seCx5LGQsZSx6KSl7c2VudD10cnVlO30Kbi5zdHlsZS52aXNpYmlsaXR5PXY7CnJldHVybiBzZW50Owp9Owp2YXIgcmVjPWZ1bmN0aW9uKHgseSxkLGUseil7CmlmKHJlYzEobnVsbCxkLmVsZW1lbnRGcm9tUG9pbnQoeCx5KSxkLGUseikpcmV0dXJuIHRydWU7CnJldHVybiBmYWxzZTsKfTsKdmFyIGlzTW91c2VEb3duPW51bGw7CnZhciBwcmV2ZW50RGVmYXVsdD1mYWxzZTsKdmFyIHRvdWNoZXZlbnQ9ZnVuY3Rpb24oZSx0eXBlKXsKdmFyIGV2PWRvY3VtZW50LmNyZWF0ZUV2ZW50KCdFdmVudCcpOwpldi5pbml0RXZlbnQodHlwZSx0cnVlLHRydWUpOwpldi5hbHRrZXk9ZmFsc2U7CmV2LmJ1YmJsZXM9dHJ1ZTsKZXYuY2FuY2VsQnViYmxlPWZhbHNlOwpldi5jYW5jZWxhYmxlPXRydWU7CmV2LmNoYXJDb2RlPTA7CmV2LmNsaWVudFg9ZS5jbGllbnRYOwpldi5jbGllbnRZPWUuY2xpZW50WTsKZXYuY3RybEtleT1mYWxzZTsKZXYuY3VycmVudFRhcmdldD1ldi5jdXJyZW50VGFyZ2V0Owpldi5rZXlDb2RlPTA7CmV2Lm1ldGFLZXk9ZmFsc2U7CmV2Lm9mZnNldFg9ZS5vZmZzZXRYOwpldi5vZmZzZXRZPWUub2Zmc2V0WTsKZXYucGFnZVg9ZS5wYWdlWDsKZXYucGFnZVk9ZS5wYWdlWTsKZXYucmV0dXJuVmFsdWU9ZS5yZXR1cm5WYWx1ZTsKZXYuc2NyZWVuWD1lLnNjcmVlblg7CmV2LnNjcmVlblk9ZS5zY3JlZW5ZOwpldi5zaGlmdEtleT1mYWxzZTsKZXYuc3JjRWxlbWVudD1lLnNyY0VsZW1lbnQ7CmV2LnRhcmdldD1lLnRhcmdldDsKZXYudGltZVN0YW1wPWUudGltZVN0YW1wOwpldi52aWV3PWUudmlldzsKZXYucm90YXRpb249MC4wOwpldi5zY2FsZT0xLjA7CmV2LnRvdWNoZXM9bmV3IEFycmF5KCk7CmV2LnRvdWNoZXNbMF09ewpjbGllbnRYOiBlLmNsaWVudFgsCmNsaWVudFk6IGUuY2xpZW50WSwKZm9yY2U6IDEuMCwKcGFnZVg6IGUucGFnZVgsCnBhZ2VZOiBlLnBhZ2VZLApzY3JlZW5YOiBlLnNjcmVlblgsCnNjcmVlblk6IGUuc2NyZWVuWSwKdGFyZ2V0OiBlLnRhcmdldCwKfTsKaWYodHlwZT09J3RvdWNoc3RhcnQnfHxpc01vdXNlRG93bilpc01vdXNlRG93bj1ldi50b3VjaGVzOwpldi5jaGFuZ2VkVG91Y2hlcz1ldi50YXJnZXRUb3VjaGVzPWlzTW91c2VEb3duOwppZih0eXBlPT0ndG91Y2hlbmQnKWlzTW91c2VEb3duPW51bGw7CnJldHVybiBldjsKfTsKdmFyIG1vdXNlZXZlbnQ9ZnVuY3Rpb24oZSl7CmlmKGUudGFyZ2V0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PSdvYmplY3QnfHxlLnRhcmdldC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT0nZW1iZWQnKXsKe2lzTW91c2VEb3duPW51bGw7cHJldmVudERlZmF1bHQ9ZmFsc2U7fQpyZXR1cm4gdHJ1ZTsKfQppZihlLnR5cGU9PSdtb3VzZWRvd24nKXsKcHJldmVudERlZmF1bHQ9ZmFsc2U7CnZhciBldj10b3VjaGV2ZW50KGUsJ3RvdWNoc3RhcnQnKTsKaWYoIWUuc2hpZnRLZXkgfHwgIXJlYyhlLmNsaWVudFgsZS5jbGllbnRZLGUudGFyZ2V0Lm93bmVyRG9jdW1lbnQsZXYsJ29udG91Y2hzdGFydCcpKXsKdmFyIGI9ZS50YXJnZXQuZGlzcGF0Y2hFdmVudChldik7CmlmKCFiKXsKcHJldmVudERlZmF1bHQ9dHJ1ZTsKZS5zdG9wUHJvcGFnYXRpb24oKTsKfQpyZXR1cm4gdHJ1ZTsKfWVsc2UgcmV0dXJuIHRydWU7Cn1lbHNlIGlmKGUudHlwZT09J21vdXNlbW92ZScpewppZihpc01vdXNlRG93bil7CnZhciBldj10b3VjaGV2ZW50KGUsJ3RvdWNobW92ZScpOwppZighZS5zaGlmdEtleSB8fCAhcmVjKGUuY2xpZW50WCxlLmNsaWVudFksZS50YXJnZXQub3duZXJEb2N1bWVudCxldiwnb250b3VjaG1vdmUnKSl7CnZhciBiPWUudGFyZ2V0LmRpc3BhdGNoRXZlbnQoZXYpOwppZighYnx8cHJldmVudERlZmF1bHQpewpwcmV2ZW50RGVmYXVsdD10cnVlOwplLnN0b3BQcm9wYWdhdGlvbigpOwp9CnJldHVybiB0cnVlOwp9ZWxzZSByZXR1cm4gdHJ1ZTsKfQp9ZWxzZSBpZihlLnR5cGU9PSdtb3VzZXVwJyl7CnZhciBldj10b3VjaGV2ZW50KGUsJ3RvdWNoZW5kJyk7CmlmKCFlLnNoaWZ0S2V5IHx8ICFyZWMoZS5jbGllbnRYLGUuY2xpZW50WSxlLnRhcmdldC5vd25lckRvY3VtZW50LGV2LCdvbnRvdWNoZW5kJykpewp2YXIgYj1lLnRhcmdldC5kaXNwYXRjaEV2ZW50KGV2KTsKaWYoIWJ8fHByZXZlbnREZWZhdWx0KXsKcHJldmVudERlZmF1bHQ9dHJ1ZTsKZS5zdG9wUHJvcGFnYXRpb24oKTsKfQpyZXR1cm4gdHJ1ZTsKfWVsc2UgcmV0dXJuIHRydWU7Cn1lbHNlIGlmKGUudHlwZT09J2NsaWNrJyl7CmlmKHdpbmRvdy5jbGljayl7d2luZG93LmNsaWNrKCk7cHJldmVudERlZmF1bHQ9ZmFsc2U7cmV0dXJuIHRydWU7fQppZihwcmV2ZW50RGVmYXVsdCl7Cn0KcHJldmVudERlZmF1bHQ9ZmFsc2U7CnJldHVybiB0cnVlOwp9CnJldHVybiB0cnVlOwp9Owpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLG1vdXNlZXZlbnQsdHJ1ZSk7CmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsbW91c2VldmVudCx0cnVlKTsKZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsbW91c2VldmVudCx0cnVlKTsKZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLG1vdXNlZXZlbnQsdHJ1ZSk7CnZhciBteXNlbGYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3RvdWNoX3RvdWNoX2pzJyk7CmlmKG15c2VsZilteXNlbGYucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChteXNlbGYpOwp9KSgpOwo=');
///__BOUNDARY__///
}

if(enable_imitation){
var platform='none';
var vendor='';
//var appName='Netscape'; //I believe WebKit always uses Netscape.
var appCodeName_idx=useragent.indexOf('/',0);
var appCodeName=useragent.substr(0,appCodeName_idx);
var appVersion=useragent.substr(appCodeName_idx+1);
if(useragent.indexOf('Android')!=-1){
	vendor='Google, Inc.';
	//platform='Linux i686'; //Android Atom machine :p
	platform='Linux armv7l';
}
if(useragent.indexOf('iPhone')!=-1){
	vendor='Apple Computer, Inc.';
	platform='iPhone';
}
if(useragent.indexOf('iPod')!=-1){
	vendor='Apple Computer, Inc.';
	platform='iPod';
}
if(useragent.indexOf('iPad')!=-1){
	vendor='Apple Computer, Inc.';
	platform='iPad';
}
if(platform=='none')return; //not smartphone

var script = '(function(){';

if(install_createtouch){
script += "\
document.createTouch = function createTouch(){'[native code]';};\
document.createTouch.toString=function(){return 'function createTouch() { [native code] }';};\
document.createTouchList = function createTouchList(){'[native code]';};\
document.createTouchList.toString=function(){return 'function createTouchList() { [native code] }';};\
";
}

script += "\
document.ondragstart = function(){return false;};\
window.ondragstart = function(){return false;};\
window.orientation = 0;\
window.ondeviceorientation = null;\
window.ondevicemotion = null;\
window.onorientationchange = null;\
\
/*self test about ontouchstart*/\
document.ontouchstart=undefined;\
if(document.ontouchstart!==null){\
	/*chrome native touch simulation not available; patch required*/\
	Object.defineProperty(document,'ontouchstart',{\
		writable: false,\
		value: null,\
	});\
	Object.defineProperty(document.documentElement,'ontouchstart',{\
		writable: false,\
		value: null,\
	});\
	\
	Object.defineProperty(document,'ontouchmove',{\
		writable: false,\
		value: null,\
	});\
	Object.defineProperty(document.documentElement,'ontouchmove',{\
		writable: false,\
		value: null,\
	});\
	\
	Object.defineProperty(document,'ontouchend',{\
		writable: false,\
		value: null,\
	});\
	Object.defineProperty(document.documentElement,'ontouchend',{\
		writable: false,\
		value: null,\
	});\
}\
window.ontouchstart=undefined;\
if(window.ontouchstart!==null){\
	window.ontouchstart = null;\
	window.ontouchmove = null;\
	window.ontouchend = null;\
}\
";

if(useragent.indexOf('Chrome')==-1&&useragent.indexOf('CrMo')==-1){ //un-chrome-ize
	//unfortunately "delete" will fail...
	script+="if('chrome' in window){window.chrome = undefined;delete window.chrome;}";
}

if(vendor=='Apple Computer, Inc.'){
script += '\
document.ongesturestart = null;\
document.documentElement.ongesturestart = null;\
window.ongesturestart = null;\
document.ongestureend = null;\
document.documentElement.ongestureend = null;\
window.ongestureend = null;\
';
}

// http://jsdo.it/wakuworks/userAgent.test
// not required in webkit
/*
script += "\
try {\
	if (!Object.prototype.__defineGetter__ &&\
		Object.defineProperty({}, 'x', { get: function(){ return true } }).x\
	) {\
		Object.defineProperty(Object.prototype, '__defineGetter__', {\
			enumerable: false,\
			configurable: true,\
			value: function(name, func) {\
				Object.defineProperty(this,name, {\
					get: func,\
					enumerable: true,\
					configurable: true\
				});\
			}\
		});\
		Object.defineProperty(Object.prototype, '__defineSetter__', {\
			enumerable: false,\
			configurable: true,\
			value: function(name, func) {\
				Object.defineProperty(this,name, {\
					set: func,\
					enumerable: true,\
					configurable: true\
				});\
			}\
		});\
	}\
}catch(defPropException){}\
";
*/

script += "\
if(navigator.__defineGetter__){\
	navigator.__defineGetter__('platform',function(){return '"+platform+"';});\
}else{\
	navigator.platform = '"+platform+"';\
}\
if(navigator.platform!='"+platform+"'){\
	var navigator_original = navigator;\
	navigator = {};\
	navigator.__proto__ = navigator_original;\
	var window_screen_original = window.screen;\
	window.screen = {};\
	window.screen.__proto__ = window_screen_original;\
}\
if(navigator.__defineGetter__){\
	navigator.__defineGetter__('userAgent',function(){return '"+useragent+"';});\
	navigator.__defineGetter__('vendor',function(){return '"+vendor+"';});\
	navigator.__defineGetter__('platform',function(){return '"+platform+"';});\
	navigator.__defineGetter__('appCodeName',function(){return '"+appCodeName+"';});\
	navigator.__defineGetter__('appVersion',function(){return '"+appVersion+"';});\
	if(navigator.__lookupGetter__)navigator.__proto__.__lookupGetter__=function __lookupGetter__(){return undefined;};\
}else{\
	navigator.userAgent = '"+useragent+"';\
	navigator.vendor = '"+vendor+"';\
	navigator.platform = '"+platform+"';\
	navigator.appCodeName = '"+appCodeName+"';\
	navigator.appVersion = '"+appVersion+"';\
}\
if(window.screen.__defineGetter__){\
	window.screen.__defineGetter__('width',function(){return window.outerWidth;});\
	window.screen.__defineGetter__('height',function(){return window.outerHeight;});\
	/*window.screen.__defineGetter__('availHeight',function(){return window.screen.height;});*/\
	window.screen.__defineGetter__('availWidth',function(){return window.screen.width;});\
	window.screen.__defineGetter__('availLeft',function(){return 0;});\
	window.screen.__defineGetter__('availTop',function(){return 0;});\
	if(window.screen.__lookupGetter__)window.screen.__proto__.__lookupGetter__=function __lookupGetter__(){return undefined;};\
}else{\
	window.screen.width=document.documentElement.clientWidth;\
	window.screen.height=document.documentElement.clientHeight;\
	/*window.screen.availHeight=window.screen.height;*/\
	window.screen.availWidth=window.screen.width;\
	window.screen.availLeft=0;\
	window.screen.availTop=0;\
}\
";

if(vendor=='Apple Computer, Inc.' || useragent.indexOf('Chrome')!=-1 || useragent.indexOf('CrMo')!=-1){ //hide plugins(flash)
script += "\
PluginArray.prototype.length=0;\
if(navigator.__defineGetter__)navigator.__defineGetter__('plugins',function(){return PluginArray.prototype;});\
else navigator.plugins=PluginArray.prototype;\
";
}

// sgfaker //
script += "\
if(document.location.href.indexOf('sgviewer.com')>=0)window.sgviewer=1;\
var myself = document.getElementById('ctouch_imitation_js');\
myself.parentNode.removeChild(myself);\
})();";

inject_tag('ctouch_imitation_js',window.btoa(script));

// Note: Chrome <=27 wrapper has been removed in cTouch r5.
}
